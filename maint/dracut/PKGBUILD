# Maintainer: Jon Nordby <jononor@gmail.com>

pkgname=dracut
pkgver=008
pkgrel=1
pkgdesc="Generic, modular, cross-distribution initramfs generation tool"
arch=('i686' 'x86_64')
url="http://sourceforge.net/apps/trac/dracut/"
license=('GPL')
depends=()
optdepends=('cryptsetup' 'lvm2')
makedepends=('git' 'docbook-xsl')
install=
source=()
noextract=()
md5sums=()

_gitroot_stable="git://dracut.git.sourceforge.net/gitroot/dracut/dracut"
_gitname_stable="dracut"

build() {
  cd "$srcdir"
  msg "Connecting to GIT server...."

  if [ -d $_gitname_stable ] ; then
    cd $_gitname_stable && git pull origin
    msg "The local files are updated."
  else
    git clone $_gitroot_stable $_gitname_stable
  fi

  # Checkout latest stable version
  git checkout $pkgver

  msg "GIT checkout done or server timeout"
  msg "Starting make..."

  rm -rf "$srcdir/$_gitname_stable-build"
  git clone "$srcdir/$_gitname_stable" "$srcdir/$_gitname_stable-build"
  cd "$srcdir/$_gitname_stable-build"

  # BUILD
  make sysconfdir=/etc || return 1
}

package() {
  cd "$srcdir/$_gitname_stable-build"
  make DESTDIR="${pkgdir}" sysconfdir=/etc install
} 

